# Toyfoundry Telemetry Export Schema

Order 2025-10-12-009 requires Toyfoundry to publish composite telemetry quilt exports for downstream
consumers (toysoldiers_ai_0 and others). This document describes the structure of the machine-readable
exports generated by `tools.telemetry.quilt_loom` when invoked with the `--export` flag.

## Source Inputs

The export pipeline relies on the composite quilt rollup stored at
`.toyfoundry/telemetry/quilt/quilt_rollup_all.json`. Each operation entry may contain:

- **Mint summary** — Aggregated data from `forge_mint_alfa.jsonl` (dry runs, last seen, status).
- **Ritual telemetry** — Drill, Parade, Purge, and Promote event streams with metadata per invocation.

## Export Artefacts

Exports are written to `.toyfoundry/telemetry/quilt/exports/`:

1. `composite_export.json` — JSON array of flattened telemetry records.
2. `composite_export.csv` — CSV counterpart with identical columns.

Each record corresponds to a single ritual event (or a mint-only placeholder if no rituals have yet run)
and includes the following fields:

| Field | Type | Description |
|:--|:--|:--|
| `operation_id` | string | Primary identifier; usually the Alfa id or batch id. |
| `last_updated` | string (ISO 8601) | Most recent timestamp observed for the operation. |
| `mint_name` | string | Human-readable Alfa name, if available. |
| `mint_first_seen` | string (ISO 8601) | Earliest mint timestamp recorded. |
| `mint_last_seen` | string (ISO 8601) | Latest mint timestamp recorded. |
| `mint_latest_status` | string | Latest mint status (`draft`, `minted`, etc.). |
| `mint_dry_runs` | integer | Count of mint dry runs logged. |
| `mint_runs` | integer | Count of non-dry-run mint executions. |
| `ritual` | string | Ritual that produced the event (`drill`, `parade`, `purge`, `promote`). |
| `event_index` | integer | Zero-based index of the event within the ritual stream. |
| `event_timestamp` | string (ISO 8601) | Timestamp emitted by the ritual telemetry entry. |
| `event_status` | string | Ritual status (`dry_run`, `completed`, etc.). |
| `event_dry_run` | boolean | True when the ritual metadata flagged the run as a dry run. |
| `event_metadata` | object / JSON string | Full ritual metadata payload. Serialized as JSON for the CSV export. |

### Notes

- Operations without ritual events still emit a single placeholder record containing mint fields and empty
  ritual columns. This ensures downstream consumers can observe mint-only batches.
- CSV exports serialize `event_metadata` as a compact JSON string to preserve arbitrary key/value pairs.
- Additional fields may be appended in future orders. Consumers should ignore unknown columns for forward
  compatibility.

## Regenerating Exports

Run the loom with the `--export` flag to update rollups and regenerate exports in a single step:

```powershell
python -m tools.telemetry.quilt_loom --export
```

Optional arguments:

- `--export-dir <path>` — Override the default export directory.
- `--telemetry` / `--ritual-telemetry` — Supply alternate input feeds if needed for testing.

The loom reports the location of the generated exports after completion.
